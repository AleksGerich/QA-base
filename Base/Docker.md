
### Общая информация:

1. Образ Docker - шаблон приложения и его зависимостей, собранных вместе
2. Контейнер Docker - экземпляр образа
3. Каждый контейнер получает случайным образом выбранный ID и случайное имя, если оно не было указано при создании.
4. Контейнер докер работает только при существовании неоконченного главного процесса в контейнере. Если данный процесс закончился (или отсутствует), то контейнер останавливается (Exited). 

@: если мы запустим контейнер из образа Ubuntu при помощи команды `docker run ubuntu` это запустит экземпляр ubuntu и немедленно выйдет из него (Exited)

(Потому что ОС сама является площадкой для запуска процессов, у нее не было процесса по умолчанию, того огонька, что поддерживал бы жизнь в контейнере.)

Если очень хочется чтобы контейнер работал без процесса внутри, то можно самому его создать
@: run ubuntu sleep 500
    - будет работать пока не истечет таймер

5. При прописывании **id** не обязательно указывать полный id контейнера (достаточно первых нескольких символов, если на Docker-хосте *нет дублирования*)
6. После запуска контейнера (docker run) создается копия указанного контейнера из Docker-хоста. Это означает, что после остановки (или завершения работы) эти копии остаются (ps -a). 
	- Для очистки от этих однотипных копий и используется *docker rm \[имя контейнера или ID]

---
## Поиск образов

[Hub-Docker](https://hub.docker.com/)
## Песочницы

- [Play with Docker](https://labs.play-with-docker.com/)

## Курс

[Курс по Docker (как на степике, только лучше)](https://rotoro.cloud/lessons/%d0%b2%d0%b2%d0%b5%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5/)

---
#### docker run \[id/Имя контейнера]
- *@: docker run redis*
- команда запуска контейнера из образа Docker
- запускает экземпляр приложения на персональном Docker-хосте
- если образ присутствует локально - просто запускает его
- если образ не присутствует локально - Docker сходит на Docker hub и спулит
этот образ себе (один раз и навсегда)
- без указания тэга (версии) будет скачан образ последней версии

#### docker run \[id/Имя контейнера]:\[тэг/версия образа]
- *@: docker run redis:5.0*
- скачивает образ указанной версии

#### docker run --name=\[выбранное имя] \[выбранный образ]
- запускает контейнер из образа с выбранным именем

#### docker run -it \[имя контейнера] (sh)
- **-it** позволяет войти внутрь контейнера при запуске
- *sh* (опционально) - запускает shell при работе с контейнером linux
	- shell увидела терминал и стала работать с ним
	- пока shell видит терминал будет существовать главный процесс

---
#### docker ps
- выводит список запущенных контейнеров, а также информацию о каждом

#### docker ps -a
- выводит список всех контейнеров (даже не запущенных) и инфу о них

#### docker ps -aq
- выводит список **ID** всех контейнеров (даже не запущенных)

#### docker stop \[id/NAMES]
- останавливает работающий контейнер

#### docker stop $(docker ps -q)
- останавливает все работающие контейнеры

#### docker rm \[id/NAMES]
- удаляет выбранный контейнер
- для удаления контейнер должен завершить свою работу (Exited) или остановлен (Stopped)
- в случае успеха возвращает имя контейнера или его id

#### docker rm $(docker ps -aq)
- удаляет абсолютно все контейнеры

---
#### docker images
- выводит список доступных образов на Docker-хосте

#### docker images -q
- выводит список ID всех докер-образов на Docker-хосте

#### docker pull \[Image-name]
- принудительная установка выбранного образа к себе на Docker-хост (допустим, для дальнейшего его использования)
- чтобы контейнер не докачивал данный зависимый образ

#### docker rmi \[Image-name]
- удаляет выбранный образ
- ВНИМАНИЕ: контейнеры, зависящие от этого образа не должны быть запущенны в системе
- Перед удалением необходимо остановить и удалить все связанные с ним контейнеры

#### docker rmi $(docker images -q)
- удаляет абсолютно все образы

#### docker exec \[id/NAMES] \[команда] (контейнера)
- выполнение команды на работающем контейнере
- менять конфигурацию на работающем приложении - не лучшая идея
@: docker exec ubuntu cat /etc/hosts
    - вывод хостов из образа ubuntu внутри выбранного контейнера
    - обращение происходит к контейнеру, а не к хостовой (главной) ОС

---
### Attach & detach - режимы работы контейнера

**Attach mode** - режим, где контейнер после запуска прикрепляется к консоли. Взаимодействие с ним невозможно (т.к. консоль используется только для логов приложения)

@: 
**docker run [rotorocloud/webapp]**
    - можно только принудительно остановить контейнер (CTRL + C). Контейнер остановится и доступ к консоли возобновится

**Detached mode** - запускает контейнер в фоновом режиме, что дает возможность взаимодействовать с оболочкой (консолью). Для этого используется флаг -d после run

@: 
**docker run *-d* [rotorocloud/webapp]**

В любой момент можно прикрепить приложение к консоли через команду:
**docker attach \[ID/NAME]** (контейнера)

---

