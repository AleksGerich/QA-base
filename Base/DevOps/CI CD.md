---
tags:
  - ci
---

---
# CI/CD

Непрерывная интеграция (Continuous Integration, CI) и непрерывная поставка (Continuous Delivery, CD) представляют собой набор принципов и практик, которые позволяют разработчикам чаще и надежнее развертывать изменения программного обеспечения

## Предпосылки появления CI/CD

1) Разработчики написали новый код
2) Администраторы вручную выкатывают обновление, начинаются проблемы, что-то не работает
3) Разработчики исправляют проблемы
4) Администраторы повторяют п. 2
5) Заказчик выкатывает на prod
6) Появляются проблемы, невоспроизводимые баги
7) Заказчик недоволен

![[Pasted image 20241201215115.png]]

## Идеальная реализация CI/CD

1. Разработчики и администраторы согласовывают друг с другом техническое решение
2. Пишется новый код (приложение + CI/CD)
3. Код собирается и выкатывается на тестовый стенд
4. Проводится тестирование
5. Код выкатывается на prod
6. Инженеры поддерживают продукт

![[Pasted image 20241201215059.png]]

## Процесс CI/CD

![[Pasted image 20241201215153.png]]

[Статья про CI/CD с примерами построения Pipeline](https://www.reg.ru/blog/rukovodstvo-po-ci-cd-v-gitlab-dlya-novichka/)

---
#ci #непрерывная_интеграция
# Подробнее про CI

Continuous Integration (CI) — это практика регулярного объединения изменений в коде в общий репозиторий с последующим автоматическим тестированием. Это помогает быстро находить и исправлять дефекты, ускоряя разработку.

Направлена на регулярное слияние кода разработчиков в основную интеграционную ветку, чаще всего — в `develop`

Начальный этап CI - внесение кода (новой части кода) разработчика в ветку (@: feature) с целью выяснения, что он качественно интегрируется во всю кодовую базу (что все не ломается)
- Сборка кода в контейнер
- Автоматическое тестирование
- Возможно развертывание для тестов

### Где реализовывается

1. В крупных компаниях - CI сервер. Отдельный сервер для сборки, тестирования, мб нагрузочного тестирования. Главное, что сервер отделен от основного приложения
2. В небольших компаниях может быть один сервер с разделением на части сборки CI и самим приложением

### Важные моменты

- в процессе CI наработки кода так и остаются в контейнере после сборки (зачастую) и не развертываются
	- @: сложно разворачивать бек на каждуюу feature ветку
	- особенно в случае незначительных обновлений
- изменения от кразработчика напрямую в ветку main не вносятся. feature ветка сливается с веткой dev

Далее изменения пушатся в ветку dev
### Основные идеи CI

1. **Частое объединение изменений**: Разработчики регулярно (как минимум один раз в день) сливают изменения в общую ветку проекта. Это позволяет избежать больших конфликтов и проблем с интеграцией, которые возникают, если изменения накапливаются слишком долго.
    
2. **Автоматизированное тестирование и сборка**: После каждого коммита или слияния CI-процесс запускает автоматизированные тесты, проверяя, что код компилируется и базовая функциональность не нарушена. Если тесты не проходят, разработчики получают мгновенную обратную связь и могут сразу исправить проблему.
    
3. **Подготовка к более поздним этапам CI/CD**: CI готовит код к непрерывной доставке или развертыванию. Стабильная основная ветка упрощает дальнейший деплой в стейджинг или продакшен.

После процесса написания кода разработчиком, его сборкой (+автотест), пушом этой *feature* ветки в **dev-ветку**, начинается процесс CD

[Сурс](https://youtu.be/pFKwmEdwZZQ)

---
#cd #непрерывная_доставка #непрерывное_развертвание 
# CD - непрерывная доставка, непрерывное развертывание

**Непрерывная доставка** (Continuous Delivery) и **непрерывное развертывание** (Continuous Deployment) — это две практики в контексте CI/CD (Continuous Integration/Continuous Deployment), направленные на автоматизацию доставки кода от разработки до продакшена

### Различия:

1. **Непрерывная доставка (Continuous Delivery)**:
    
    - Автоматизирует процесс интеграции кода
    - На этом этапе ветка, например, `main` или `release`, проходит автоматизированные проверки и тесты
    - Код, после прохождения всех автоматизированных тестов и сборок, _готов к выпуску на продакшен_ и находится в таком состоянии постоянно
    - Разработка, тестирование и сборка проходят через автоматизированный процесс, и результаты доступны для выпуска
    - Финальное развертывание на продакшен требует _ручного подтверждения_. То есть, команда выбирает, когда выпустить эти изменения в продакшен, даже если весь процесс до этой точки автоматизирован
	
2. **Непрерывное развертывание (Continuous Deployment)**:
    
    - Включает все этапы непрерывной доставки, но здесь _автоматически развертывает код на продакшен_ после успешного прохождения всех этапов тестирования и сборки
    - Исключает необходимость ручного вмешательства, и каждый успешный коммит может стать новым релизом.
    - Каждое успешное изменение в основной ветке (`main`) будет развернуто на продакшен без ручного вмешательства
    - Это исключает стадии, связанные с ручным контролем, поскольку считается, что автоматизация и тестирование достаточно надежны, чтобы выпускать код сразу после успешной проверки

**Основное различие** — в ручном подтверждении. Непрерывная доставка останавливается перед продакшеном для проверки, тогда как непрерывное развертывание сразу выпускает изменения на продакшен.

В обоих случаях изменения обычно происходят в стабильной ветке (например, `main`), которая проходит через тестирование и сборку. dev-ветка или другие промежуточные ветки чаще используются для разработки и не всегда полностью стабильны для выпуска на продакшен.

## Сосуществование непрерывного развертывания и доставки

**Непрерывная доставка** и **непрерывное развертывание** могут сосуществовать и быть адаптированы в рамках одного проекта, если их разграничить по разным средам и уровням критичности

1. **Комбинированный подход по средам**:
    
    - **Непрерывное развертывание** можно применить для среды, где риск минимален и нужны частые обновления, например, для стейджинга или тестовых сред. Это позволяет видеть и тестировать изменения сразу же, как только они проходят автоматизированные тесты.
    - **Непрерывная доставка** используется для выпуска на продакшен. Выпуск в продакшен выполняется с ручным подтверждением, чтобы соблюсти дополнительные уровни контроля.
    
2. **Разделение по типу изменений**:
    
    - Проект может применять непрерывное развертывание для _минорных или безопасных обновлений_ (например, исправлений багов, незначительных улучшений), которые могут быть автоматически развернуты на продакшен.
    - Для более крупных или критичных изменений может использоваться подход непрерывной доставки, где развертывание в продакшен контролируется вручную после прохождения всех проверок.

---
#pipeline #пайплайны #ci/cd
# Pipeline (CI/CD)

CI/CD пайплайн используется для автоматизации процессов разработки, тестирования и развертывания программного обеспечения. Это серия шагов, которые код проходит перед развертыванием на рабочую среду

- **CI (Continuous Integration)**: Интеграция кода в общий репозиторий разработчиками на постоянной основе. При каждом изменении запускаются автоматизированные тесты.
    
- **CD (Continuous Delivery/Deployment)**: Автоматизация доставки изменений в коде до производственной среды (continuous delivery) или автоматическая установка в рабочую среду (continuous deployment).
    
    Стандартный CI/CD пайплайн включает:
    - Сборку (build).
    - Тестирование (unit, integration, UI тесты).
    - Развертывание (deploy) на тестовые или продакшен-сервера.

Пример инструментов: Jenkins, GitLab CI, CircleCI

## Преимущества использования pipeline:

- **Автоматизация**: Пайплайны позволяют автоматизировать повторяющиеся процессы, уменьшая возможность ошибок.
- **Постоянство**: Обеспечивает предсказуемость результатов, так как пайплайн выполняется одинаково каждый раз.
- **Масштабируемость**: Легко адаптируется для обработки больших объемов данных или кода.

[реализация pipeline на VPS](https://youtu.be/prOarIqL5Qs)

---
#pipeline 
# Gitlab CI

***Gitlab CI*** - Веб-инструмент жизненного цикла DevOps с открытым исходным кодом, представляющий систему управления репозиториями кода для Git с собственной вики, системой отслеживания ошибок, CI/CD пайплайном и другими функциями.

Основной сущностью в GitLab CI/CD является пайплайн – конвейер, который может состоять из:
- **Джобов** (jobs) – описывающих что нужно выполнить;
- **Этапов** (stages) – указывающих когда или в какой последовательности нужно выполнить джобы.

Если все джобы завершились успешно, выполнение переходит к следующему этапу и так далее. Если джоба завершилась ошибкой, то выполнение останавливается и весь пайплайн считается провальным.

![[Pasted image 20241201215153.png]]

![[Pasted image 20241201215406.png]]